---
title: "Budget and Limits"
description: "Enterprise-grade budget management and cost control with hierarchical budget allocation through virtual keys, teams, and customers."
icon: "money-bills"
---

## Overview

Budgeting and rate limiting are a core feature of Bifrost's governance system managed through [Virtual Keys](./virtual-keys).

Bifrost's budget management system provides comprehensive cost control and financial governance for enterprise AI deployments. It operates through a **hierarchical budget structure** that enables granular cost management, usage tracking, and financial oversight across your entire organization.

**Core Hierarchy:**
```
Customer (has independent budget)
    ↓ (one-to-many)
Team (has independent budget) 
    ↓ (one-to-many)
Virtual Key (has independent budget + rate limits)
    ↓ (one-to-many)
Provider Config (has independent budget + rate limits)

OR

Customer (has independent budget)
    ↓ (direct attachment)
Virtual Key (has independent budget + rate limits)
    ↓ (one-to-many)
Provider Config (has independent budget + rate limits)

OR

Virtual Key (standalone - has independent budget + rate limits)
    ↓ (one-to-many)
Provider Config (has independent budget + rate limits)
```

**Key Capabilities:**
- **Virtual Keys** - Primary access control via `x-bf-vk` header (exclusive team OR customer attachment)
- **Budget Management** - Independent budget limits at each hierarchy level with cumulative checking
- **Rate Limiting** - Request and token-based throttling at both VK and provider config levels
- **Provider-Level Governance** - Granular budgets and rate limits per AI provider within a virtual key
- **Model/Provider Filtering** - Granular access control per virtual key  
- **Usage Tracking** - Real-time monitoring and audit trails
- **Audit Headers** - Optional team and customer identification

---

## Budget Management

### Cost Calculation

Bifrost automatically calculates costs based on:
- **Provider Pricing** - Real-time model pricing data
- **Token Usage** - Input + output tokens from API responses
- **Request Type** - Different pricing for chat, text, embedding, speech, transcription
- **Cache Status** - Reduced costs for cached responses
- **Batch Operations** - Volume discounts for batch requests

All cost calculation details are covered in [Architecture > Framework > Model Catalog](../../architecture/framework/model-catalog).

### Budget Checking Flow

When a request is made with a virtual key, Bifrost checks **all applicable budgets independently** in the hierarchy. Each budget must have sufficient remaining balance for the request to proceed.

**Checking Sequence:**

**For VK → Team → Customer:**
```
1. ✓ Provider Config Budget (if provider config has budget)
2. ✓ VK Budget (if VK has budget)
3. ✓ Team Budget (if VK's team has budget)  
4. ✓ Customer Budget (if team's customer has budget)
```

**For VK → Customer (direct):**
```
1. ✓ Provider Config Budget (if provider config has budget)
2. ✓ VK Budget (if VK has budget)
3. ✓ Customer Budget (if VK's customer has budget)
```

**For Standalone VK:**
```
1. ✓ Provider Config Budget (if provider config has budget)
2. ✓ VK Budget (if VK has budget)
```

**Important Notes:**
- **All applicable budgets must pass** - any single budget failure blocks the request
- **Budgets are independent** - each tracks its own usage and limits
- **Costs are deducted from all applicable budgets** - same cost applied to each level
- **Rate limits checked at provider config and VK levels** - teams and customers have no rate limits
- **Provider selection** - providers that exceed their budget or rate limits are excluded from [routing](./routing)

**Example:**
```
- Provider config budget: $4/$5 remaining ✓
- VK budget: $9/$10 remaining ✓
- Team budget: $15/$20 remaining ✓  
- Customer budget: $45/$50 remaining ✓
- Result: Allowed (no budget is exceeded)

- After request: 
    - Request cost: $2 
    - Updated Provider=$6/$5, VK=$11/$10, Team=$17/$20, Customer=$47/$50
    - Then the next request will be blocked (both provider and VK budgets exceeded).
```

## Provider Limit Precedence

Provider-level limits take precedence over API key (Virtual Key), model, team, and customer limits. This means **if a provider limit is exceeded, requests to that provider will be blocked even if other limits have not been reached**.

### Precedence Hierarchy

When a request is made, limits are checked in the following order:

**Checking Sequence:**
```
1. ✓ Provider Config Budget (checked FIRST)
2. ✓ Provider Config Rate Limits (checked FIRST)
3. ✓ VK Budget (checked after provider limits)
4. ✓ VK Rate Limits (checked after provider limits)
5. ✓ Team Budget (checked after VK limits)
6. ✓ Customer Budget (checked after team limits)
```

**Important:** If any provider-level limit (budget or rate limit) is exceeded, the request is immediately blocked, regardless of the status of API key, team, or customer limits.

### Example Scenario

Consider this configuration:
- **Provider Config Budget**: $0.05 (very low)
- **VK Budget**: $10.00 (much higher)

**Result:** Requests will be blocked when the $0.05 provider budget is consumed, even though the VK still has $9.95 remaining. This ensures provider-level governance is strictly enforced.

### When to Use Provider Limits

Use provider-level limits when you need:
- **Hard caps** on spending or usage per provider
- **Provider isolation** - ensure one provider doesn't consume all resources
- **Cost containment** - prevent runaway spending on expensive providers
- **Compliance** - enforce strict limits at the provider level

## Rate Limiting

Rate limits protect your system from abuse and manage traffic by setting thresholds on request frequency and token usage over a specific time window. Rate limits can be configured at **both the Virtual Key level and Provider Config level** for granular control.

Bifrost supports two types of rate limits that work in parallel:
- **Request Limits**: Control the maximum number of API calls that can be made within a set duration (e.g., 100 requests per minute).
- **Token Limits**: Control the maximum number of tokens (prompt + completion) that can be processed within a set duration (e.g., 50,000 tokens per hour).

### Rate Limit Hierarchy

Rate limits are checked in hierarchical order:
```
1. ✓ Provider Config Rate Limits (if provider config has rate limits)
2. ✓ Virtual Key Rate Limits (if VK has rate limits)
```

For a request to be allowed, it must pass both the request limit and token limit checks at **all applicable levels**. If a provider config exceeds its rate limits, that provider is excluded from routing, but other providers within the same virtual key remain available.

### Provider-Level Rate Limiting

Provider configs within a virtual key can have independent rate limits, enabling:
- **Per-Provider Throttling**: Different rate limits for OpenAI vs Anthropic
- **Provider Isolation**: Rate limit violations on one provider don't affect others
- **Granular Control**: Fine-tune limits based on provider capabilities and costs

## Reset Durations

Budgets and rate limits support flexible reset durations with an intuitive number + unit format:

### Flexible Duration Format

Specify any arbitrary duration by entering a **number** and selecting a **unit**:

**Supported Units:**
- `m` - Minutes (e.g., `90m` = 90 minutes = 1.5 hours)
- `h` - Hours (e.g., `4h` = 4 hours, `36h` = 1.5 days)
- `d` - Days (e.g., `7d` = 1 week, `45d` = 45 days)
- `w` - Weeks (e.g., `2w` = 2 weeks)
- `M` - Months (approximated as 30 days, e.g., `3M` = 3 months)
- `y` or `Y` - Years (approximated as 365 days, e.g., `1y` = 1 year)

**Common Patterns:**
- **Rate Limits**: `15m`, `90m`, `4h`, `1d` for request throttling
- **Budgets**: `1d`, `7d`, `1M`, `3M` for cost control

**Examples:**
- Configure a budget to reset every **90 minutes**: Enter `90` and select `Minutes`
- Set a rate limit to reset every **4 hours**: Enter `4` and select `Hours`
- Create a monthly budget that resets every **45 days**: Enter `45` and select `Days`

<Note>
The flexible duration format is backward compatible with existing configurations using standard formats like `1h`, `1d`, `1M`, etc.
</Note>

---

## Configuration Guide

Configure provider-level budgets and rate limits using any of these methods:

<Tabs>
<Tab title="Web UI">

The Bifrost Web UI provides an intuitive interface for configuring provider-level governance through the Virtual Keys management page.

### Creating Virtual Keys with Provider Configs

1. **Navigate to Virtual Keys**: Go to **Virtual Keys** page in the Bifrost dashboard
2. **Create New Virtual Key**: Click "Create Virtual Key" button
3. **Configure Providers**: In the "Provider Configurations" section:
   - Add multiple providers with individual weights
   - Set provider-specific budgets and rate limits
   - Configure allowed models per provider

### Provider Configuration Interface

![Virtual Key Provider Configuration Interface](../../media/ui-virtual-key-provider-config.png)

**Key Features:**
- **Visual Provider Cards**: Each provider displays as an expandable card
- **Budget Controls**: Set spending limits with reset periods per provider
- **Rate Limit Controls**: Configure token and request limits independently
- **Model Filtering**: Specify allowed models for each provider
- **Weight Distribution**: Visual indicators for load balancing weights
- **Real-time Validation**: Immediate feedback on configuration errors

### Monitoring Provider Usage

![Provider Usage Sheet](../../media/ui-virtual-key-provider-usage-sheet.png)

The info sheet for the virtual key provides real-time monitoring of:
- Budget consumption per provider
- Rate limit utilization (tokens and requests)
- Provider availability status
- Usage trends and forecasting

</Tab>
<Tab title="API">

Use the Bifrost HTTP API to programmatically manage provider-level governance configurations.

### Create Virtual Key with Provider Configs

```bash
curl -X POST "https://your-bifrost-instance.com/api/governance/virtual-keys" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "marketing-team-vk",
    "description": "Marketing team virtual key with provider-specific limits",
    "provider_configs": [
      {
        "provider": "openai",
        "weight": 0.7,
        "allowed_models": ["gpt-4", "gpt-3.5-turbo"],
        "budget": {
          "max_limit": 500.00,
          "reset_duration": "1M"
        },
        "rate_limit": {
          "token_max_limit": 1000000,
          "token_reset_duration": "1h",
          "request_max_limit": 1000,
          "request_reset_duration": "1h"
        }
      },
      {
        "provider": "anthropic",
        "weight": 0.3,
        "allowed_models": ["claude-3-opus", "claude-3-sonnet"],
        "budget": {
          "max_limit": 200.00,
          "reset_duration": "1M"
        },
        "rate_limit": {
          "token_max_limit": 500000,
          "token_reset_duration": "1h",
          "request_max_limit": 500,
          "request_reset_duration": "1h"
        }
      }
    ],
    "budget": {
      "max_limit": 1000.00,
      "reset_duration": "1M"
    },
    "is_active": true
  }'
```

### Update Provider Configuration

```bash
curl -X PUT "https://your-bifrost-instance.com/api/governance/virtual-keys/{vk_id}" \
  -H "Content-Type: application/json" \
  -d '{
    "provider_configs": [
      {
        "id": 1,
        "provider": "openai",
        "weight": 0.8,
        "budget": {
          "max_limit": 600.00,
          "reset_duration": "1M"
        },
        "rate_limit": {
          "token_max_limit": 1200000,
          "token_reset_duration": "1h"
        }
      }
    ]
  }'
```

### API Response Structure

```json
{
  "message": "Virtual key created successfully",
  "virtual_key": {
    "id": "vk_123",
    "name": "marketing-team-vk",
    "value": "vk_abc123def456",
    "provider_configs": [
      {
        "id": 1,
        "provider": "openai",
        "weight": 0.7,
        "allowed_models": ["gpt-4", "gpt-3.5-turbo"],
        "budget": {
          "id": "budget_789",
          "max_limit": 500.00,
          "current_usage": 0.00,
          "reset_duration": "1M",
          "last_reset": "2024-01-01T00:00:00Z"
        },
        "rate_limit": {
          "id": "rate_limit_456",
          "token_max_limit": 1000000,
          "token_current_usage": 0,
          "token_reset_duration": "1h",
          "token_last_reset": "2024-01-01T00:00:00Z",
          "request_max_limit": 1000,
          "request_current_usage": 0,
          "request_reset_duration": "1h",
          "request_last_reset": "2024-01-01T00:00:00Z"
        }
      }
    ]
  }
}
```

### Field Descriptions

| Field | Type | Description |
|-------|------|-------------|
| `provider` | string | AI provider name (e.g., "openai", "anthropic") |
| `weight` | float | Load balancing weight (0.0-1.0) |
| `allowed_models` | array | Specific models allowed for this provider |
| `budget.max_limit` | float | Maximum spend in USD |
| `budget.reset_duration` | string | Reset period (e.g., "1h", "1d", "1M") |
| `rate_limit.token_max_limit` | integer | Maximum tokens per period |
| `rate_limit.request_max_limit` | integer | Maximum requests per period |

</Tab>
<Tab title="config.json">

Configure provider-level governance through Bifrost's configuration file for declarative management.

### Basic Configuration Structure

```json
{
  "governance": {
    "virtual_keys": [
      {
        "name": "development-team-vk",
        "description": "Development team with multi-provider setup",
        "provider_configs": [
          {
            "provider": "openai",
            "weight": 0.6,
            "allowed_models": ["gpt-4", "gpt-3.5-turbo"],
            "budget": {
              "max_limit": 1000.00,
              "reset_duration": "1M"
            },
            "rate_limit": {
              "token_max_limit": 2000000,
              "token_reset_duration": "1h",
              "request_max_limit": 2000,
              "request_reset_duration": "1h"
            }
          },
          {
            "provider": "anthropic",
            "weight": 0.4,
            "allowed_models": ["claude-3-opus", "claude-3-sonnet"],
            "budget": {
              "max_limit": 500.00,
              "reset_duration": "1M"
            },
            "rate_limit": {
              "token_max_limit": 1000000,
              "token_reset_duration": "1h",
              "request_max_limit": 1000,
              "request_reset_duration": "1h"
            }
          }
        ],
        "budget": {
          "max_limit": 2000.00,
          "reset_duration": "1M"
        },
        "rate_limit": {
          "token_max_limit": 5000000,
          "token_reset_duration": "1h",
          "request_max_limit": 3000,
          "request_reset_duration": "1h"
        },
        "is_active": true
      }
    ]
  }
}
```

### Advanced Configuration Examples

#### Cost-Optimized Setup
```json
{
  "governance": {
    "virtual_keys": [
      {
        "name": "cost-optimized-vk",
        "provider_configs": [
          {
            "provider": "openai-gpt-3.5",
            "weight": 0.8,
            "budget": {
              "max_limit": 50.00,
              "reset_duration": "1d"
            },
            "rate_limit": {
              "request_max_limit": 1000,
              "request_reset_duration": "1h"
            }
          },
          {
            "provider": "openai-gpt-4",
            "weight": 0.2,
            "budget": {
              "max_limit": 200.00,
              "reset_duration": "1d"
            },
            "rate_limit": {
              "request_max_limit": 100,
              "request_reset_duration": "1h"
            }
          }
        ]
      }
    ]
  }
}
```

#### High-Volume Production Setup
```json
{
  "governance": {
    "virtual_keys": [
      {
        "name": "production-high-volume-vk",
        "provider_configs": [
          {
            "provider": "openai",
            "weight": 0.5,
            "budget": {
              "max_limit": 5000.00,
              "reset_duration": "1M"
            },
            "rate_limit": {
              "token_max_limit": 10000000,
              "token_reset_duration": "1h",
              "request_max_limit": 10000,
              "request_reset_duration": "1h"
            }
          },
          {
            "provider": "anthropic",
            "weight": 0.3,
            "budget": {
              "max_limit": 3000.00,
              "reset_duration": "1M"
            },
            "rate_limit": {
              "token_max_limit": 6000000,
              "token_reset_duration": "1h",
              "request_max_limit": 6000,
              "request_reset_duration": "1h"
            }
          },
          {
            "provider": "azure-openai",
            "weight": 0.2,
            "budget": {
              "max_limit": 2000.00,
              "reset_duration": "1M"
            },
            "rate_limit": {
              "token_max_limit": 4000000,
              "token_reset_duration": "1h",
              "request_max_limit": 4000,
              "request_reset_duration": "1h"
            }
          }
        ]
      }
    ]
  }
}
```

**Validation Rules:**
- Budget limits must be positive numbers
- Reset durations must be valid time formats
- Rate limits must be positive integers
- Provider names must match configured providers

</Tab>
</Tabs>

## Provider-Level Governance Examples

### Example 1: Mixed Provider Budgets

A virtual key configured with multiple providers and different budget allocations:

```json
{
  "name": "marketing-team-vk",
  "budget": { "max_limit": 100, "reset_duration": "1M" },
  "provider_configs": [
    {
      "provider": "openai",
      "weight": 0.7,
      "budget": { "max_limit": 50, "reset_duration": "1M" }
    },
    {
      "provider": "anthropic", 
      "weight": 0.3,
      "budget": { "max_limit": 30, "reset_duration": "1M" }
    }
  ]
}
```

**Behavior:**
- OpenAI requests limited to 50 dollars/month at provider level + 100 dollars/month at VK level
- Anthropic requests limited to 30 dollars/month at provider level + 100 dollars/month at VK level
- If any provider's budget is exhausted, all requests to that provider will be blocked

### Example 2: Provider-Specific Rate Limits

Different rate limits based on provider capabilities:

```json
{
  "name": "high-volume-vk",
  "provider_configs": [
    {
      "provider": "openai",
      "rate_limit": {
        "request_max_limit": 1000,
        "request_reset_duration": "1h",
        "token_max_limit": 1000000,
        "token_reset_duration": "1h"
      }
    },
    {
      "provider": "anthropic",
      "rate_limit": {
        "request_max_limit": 500,
        "request_reset_duration": "1h",
        "token_max_limit": 500000,
        "token_reset_duration": "1h"
      }
    }
  ]
}
```

**Behavior:**
- OpenAI: 1000 requests/hour, 1M tokens/hour
- Anthropic: 500 requests/hour, 500K tokens/hour
- If any provider's rate limits are exceeded, all requests to that provider will be blocked

### Example 3: Failover Strategy

Provider configurations with budget-based failover:

```json
{
  "name": "cost-optimized-vk",
  "provider_configs": [
    {
      "provider": "openai-cheap",
      "weight": 1.0,
      "budget": { "max_limit": 10, "reset_duration": "1d" }
    },
    {
      "provider": "openai-premium",
      "weight": 0.0,
      "budget": { "max_limit": 50, "reset_duration": "1d" },
      "rate_limit": {
        "request_max_limit": 100,
        "request_reset_duration": "1h",
        "token_max_limit": 50000,
        "token_reset_duration": "1h"
      }
    }
  ]
}
```

**Behavior:**
- Primary: Use cheap provider until $10 daily budget exhausted
- Fallback: Automatically switch to premium provider when cheap option unavailable. To enable this, you should not send `provider` name in the request body, read [Routing](./routing#automatic-fallbacks) for more details.
- Cost containment: Prevent unexpected overspend on premium resources and limit the number of requests to the premium provider


## Key Benefits of Provider-Level Governance

- **Granular Control**: Set specific spending limits and rate limits per AI provider
- **Automatic Fallback**: Route to alternative providers when budgets or rate limits are exceeded
- **Cost Control**: Track and control spending by provider for better financial oversight
- **Performance Testing**: A/B testing across providers with controlled budgets
- **Multi-Provider Strategies**: Primary/backup provider configurations
- **Cost-Tiered Access**: Cheap providers for basic tasks, premium for complex workloads  

---

## Next Steps

- **[Routing](./routing)** - Direct requests to specific AI models, providers, and keys using Virtual Keys.
- **[MCP Tool Filtering](./mcp-tools)** - Manage MCP clients/tools for virtual keys.
- **[Tracing](../observability/default)** - Audit trails and request tracking

---

## Consolidated Budgets & Limits View

Bifrost provides a unified **Budgets & Limits** page that consolidates all budget and rate limit configurations across your organization into a single, comprehensive view.

### Accessing the Consolidated View

Navigate to **Governance > Budgets & Limits** in the Bifrost dashboard to see all configured limits organized by type:

### View Organization

The consolidated view organizes limits into separate sections:

1. **Providers** - Budgets and rate limits configured at the provider level
2. **API Keys** - Budgets and rate limits for each Virtual Key
3. **Models** - Budgets and rate limits configured for specific models
4. **Teams** - Budget allocations for teams
5. **Customers** - Budget allocations for customers

### Features

- **Summary Cards**: See at-a-glance counts of configured limits by type
- **Usage Progress Bars**: Visual indicators showing current usage vs. limits (green < 80%, amber 80-100%, red exceeded)
- **Reset Duration Display**: See when each limit will reset
- **Quick Actions**: Navigate directly to management pages for each limit type
- **Provider Precedence Notice**: Clear explanation that provider limits override other limits

### Benefits

- **Centralized Monitoring**: View all limits across your organization in one place
- **Usage Tracking**: Monitor which limits are approaching exhaustion
- **Quick Management**: Jump directly to configuration pages for any limit type
- **Cross-Reference**: Compare limits across providers, API keys, and models

<Note>
The consolidated view displays limits from all hierarchy levels, making it easy to identify where governance policies are applied and how they're being utilized.
</Note>
